import Foundation

//===----------------------------------------------------------------------===//
// Error Utilities
//===----------------------------------------------------------------------===//

// swiftlint:disable all
internal extension EncodingError {
	/// Returns a `.invalidValue` error describing the given invalid floating-point value.
	///
	///
	/// - parameter value: The value that was invalid to encode.
	/// - parameter path: The path of `CodingKey`s taken to encode this value.
	/// - returns: An `EncodingError` with the appropriate path and debug description.
	static func _invalidFloatingPointValue<T: FloatingPoint>(_ value: T, at codingPath: [CodingKey]) -> EncodingError {
		let valueDescription: String
		if value == T.infinity {
			valueDescription = "\(T.self).infinity"
		} else if value == -T.infinity {
			valueDescription = "-\(T.self).infinity"
		} else {
			valueDescription = "\(T.self).nan"
		}

		let debugDescription = "Unable to encode \(valueDescription) directly in Dictionary. Use DictionaryEncoder.NonConformingFloatEncodingStrategy.convertToString to specify how the value should be encoded."
		return .invalidValue(value, EncodingError.Context(codingPath: codingPath, debugDescription: debugDescription))
	}
}

internal extension DecodingError {
	/// Returns a `.typeMismatch` error describing the expected type.
	///
	/// - parameter path: The path of `CodingKey`s taken to decode a value of this type.
	/// - parameter expectation: The type expected to be encountered.
	/// - parameter reality: The value that was encountered instead of the expected type.
	/// - returns: A `DecodingError` with the appropriate path and debug description.
	static func _typeMismatch(at path: [CodingKey], expectation: Any.Type, reality: Any) -> DecodingError {
		let description = "Expected to decode \(expectation) but found \(_typeDescription(of: reality)) instead."
		return .typeMismatch(expectation, Context(codingPath: path, debugDescription: description))
	}

	/// Returns a description of the type of `value` appropriate for an error message.
	///
	/// - parameter value: The value whose type to describe.
	/// - returns: A string describing `value`.
	/// - precondition: `value` is one of the types below.
	static func _typeDescription(of value: Any) -> String {
		if value is NSNull {
			return "a null value"
		} else if value is NSNumber { /* TODO: If swift-corelibs-foundation isn't updated to use NSNumber, this check will be necessary: || value is Int || value is Double */
			return "a number"
		} else if value is String {
			return "a string/data"
		} else if value is [Any] {
			return "an array"
		} else if value is [String: Any] {
			return "a dictionary"
		} else {
			return "\(type(of: value))"
		}
	}
}
